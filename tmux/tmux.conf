# ==============================================================================
# Tmux Configuration
# ==============================================================================
# A comprehensive tmux configuration with Catppuccin theme, vim-style navigation,
# and modern plugin integrations.
#
# Plugin Version Management:
# --------------------------
# To pin plugin versions, add #vX.Y.Z after the plugin name:
#   set -g @plugin 'catppuccin/tmux#v2.1.3'
#
# To enable Renovate auto-updates, add a comment before each plugin:
#   # renovate: datasource=github-releases depName=catppuccin/tmux
#   set -g @plugin 'catppuccin/tmux#v2.1.3'
#
# Keybindings Reference:
# ----------------------
# See tmux/README.md for complete keybinding reference
# ==============================================================================

# ------------------------------------------------------------------------------
# General Settings
# ------------------------------------------------------------------------------

# Terminal and color settings
# Use screen-256color for broad compatibility
# Default: screen
set -g default-terminal "screen-256color"

# Enable true color (RGB) support for terminals that support it
# This allows full 24-bit color in nvim, bat, etc.
set -ga terminal-overrides ",*256col*:Tc"

# Enable mouse support for scrolling, pane selection, and resizing
# Default: off
set -g mouse on

# Set scrollback buffer to 100 million lines
# Default: 2000
set -g history-limit 100000000

# Start window numbering at 1 (matches keyboard layout)
# Default: 0
set -g base-index 1

# Start pane numbering at 1
# Default: 0
setw -g pane-base-index 1

# Renumber windows sequentially when one is closed
# Default: off
set -g renumber-windows on

# Remove delay after pressing Escape (important for vim/nvim)
# Default: 500
set -sg escape-time 0

# Focus events enabled for terminals that support them
# Allows vim/nvim to detect when tmux pane gains/loses focus
# Default: off
set -g focus-events on

# Use system clipboard (OSC 52 escape sequence)
# Works on macOS and Linux with proper terminal support
# Default: off
set -g set-clipboard on

# Don't exit tmux when closing the last session
# Instead, switch to another session if available
# Default: on
set -g detach-on-destroy off

# Status bar position (macOS style - at top)
# Default: bottom
set -g status-position top

# Update status bar every second (for time display)
# Default: 15
set -g status-interval 1

# ------------------------------------------------------------------------------
# Key Bindings
# ------------------------------------------------------------------------------

# Change prefix from Ctrl-b to Ctrl-a (more ergonomic, like GNU Screen)
# Default: C-b
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Reload tmux configuration
# Default: None
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# ------------------------------------------------------------------------------
# Window and Pane Splitting (via tmux-pain-control)
# ------------------------------------------------------------------------------

# tmux-pain-control provides these keybindings automatically:
#   prefix + |  - Split horizontal (pane on right)
#   prefix + -  - Split vertical (pane below)
#   prefix + \  - Split full-width horizontal
#   prefix + _  - Split full-width vertical
# All splits open in the current directory.

# Unbind defaults to avoid conflicts
unbind '"'
unbind %

# Alternative bindings from omerxx (vim-style letters)
# Uncomment to use these instead or in addition:
# bind v split-window -h -c "#{pane_current_path}"  # v for vertical split
# bind s split-window -v -c "#{pane_current_path}"  # s for split (horizontal)

# ------------------------------------------------------------------------------
# Pane Navigation (via tmux-pain-control)
# ------------------------------------------------------------------------------

# tmux-pain-control provides vim-style navigation with prefix:
#   prefix + h/j/k/l - Navigate panes (left/down/up/right)

# Switch panes using Ctrl+Alt-arrow without prefix
# Note: Alt-arrow conflicts with macOS word navigation
# Default: None
bind -n C-M-Left select-pane -L
bind -n C-M-Right select-pane -R
bind -n C-M-Up select-pane -U
bind -n C-M-Down select-pane -D

# ------------------------------------------------------------------------------
# Window Navigation
# ------------------------------------------------------------------------------

# Alternative bindings from omerxx (vim-style H/L for prev/next window)
# Uncomment to use these instead of default p/n:
# bind H previous-window  # Instead of prefix + p
# bind L next-window      # Instead of prefix + n

# Switch to last window with Ctrl-a (double-tap prefix)
# Default: prefix + l (but we use l for pane navigation)
# bind ^A last-window

# ------------------------------------------------------------------------------
# Pane Resizing (via tmux-pain-control)
# ------------------------------------------------------------------------------

# tmux-pain-control provides vim-style resizing with prefix:
#   prefix + H/J/K/L - Resize panes (left/down/up/right) by 5 cells
#   prefix + Shift-arrows - Also resize panes
# These are repeatable (can hold prefix and tap multiple times).

# Alternative: omerxx uses , . - = for resizing (larger increments)
# Uncomment to use these:
# bind -r -T prefix , resize-pane -L 20
# bind -r -T prefix . resize-pane -R 20
# bind -r -T prefix - resize-pane -D 7
# bind -r -T prefix = resize-pane -U 7

# ------------------------------------------------------------------------------
# Other Key Bindings
# ------------------------------------------------------------------------------

# Alternative bindings from omerxx:
# bind c kill-pane          # c for close (default: x)
# bind x swap-pane -D       # x for swap (default: would kill)
# bind K send-keys "clear"\; send-keys "Enter"  # Clear screen
# bind * setw synchronize-panes  # Type in all panes simultaneously
# bind P set pane-border-status  # Toggle pane border status

# ------------------------------------------------------------------------------
# Pane Borders (Catppuccin-inspired colors)
# ------------------------------------------------------------------------------

# Active pane border - magenta
# Default: green
set -g pane-active-border-style 'fg=magenta,bg=default'

# Inactive pane border - gray
# Default: default
set -g pane-border-style 'fg=brightblack,bg=default'

# ------------------------------------------------------------------------------
# Copy Mode (Vim-like)
# ------------------------------------------------------------------------------

# Use vim keybindings in copy mode
# Default: emacs
setw -g mode-keys vi

# Setup 'v' to begin selection as in Vim
bind-key -T copy-mode-vi v send-keys -X begin-selection

# Copy with 'y' to system clipboard (macOS)
# For Linux, this works with set-clipboard on
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Also copy with Enter
unbind -T copy-mode-vi Enter
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# ------------------------------------------------------------------------------
# Plugins (TPM - Tmux Plugin Manager)
# ------------------------------------------------------------------------------
# TPM is automatically installed via: make bootstrap
# Install plugins: prefix + I (Ctrl-a + Shift-i)
# Update plugins: prefix + U
# Uninstall removed plugins: prefix + alt + u
#
# To pin versions, add #vX.Y.Z:
#   set -g @plugin 'catppuccin/tmux#v2.1.3'

# Override TPM path to use traditional location instead of XDG auto-detection
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins/'

# Core plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'

# ------------------------------------------------------------------------------
# Catppuccin Theme (v2.1+)
# ------------------------------------------------------------------------------
# Documentation: https://github.com/catppuccin/tmux

set -g @plugin 'catppuccin/tmux'

# Flavor: latte, frappe, macchiato, or mocha
# Default: mocha
set -g @catppuccin_flavor 'mocha'

# Window status style: basic, rounded, slanted, custom, or none
# Default: basic
set -g @catppuccin_window_status_style "rounded"

# Enable pane status (shows pane info in border)
# Default: no
set -g @catppuccin_pane_status_enabled "no"

# Window text - show window name, add () indicator when zoomed
# Default: " #T" (pane title)
set -g @catppuccin_window_text " #W"
set -g @catppuccin_window_current_text " #W#{?window_zoomed_flag,(ÓÆÅ),}"

# Status bar configuration using Catppuccin modules
# Available modules: application, directory, session, user, host, date_time,
#                   battery, cpu, weather, load, and more
# See: https://github.com/catppuccin/tmux/blob/main/docs/reference/status-line.md

set -g status-left-length 100
set -g status-right-length 100

# Left side: session name
set -g status-left "#{E:@catppuccin_status_session}"

# Right side: directory and time
set -g status-right "#{E:@catppuccin_status_directory}"
set -ag status-right "#{E:@catppuccin_status_date_time}"

# Custom date/time format - just hours:minutes
# Default: "%Y-%m-%d %H:%M"
set -g @catppuccin_date_time_text "%H:%M:%S"

# Custom directory text - show only basename
# Default: "#{b:pane_current_path}"
set -g @catppuccin_directory_text "#{b:pane_current_path}"

# ------------------------------------------------------------------------------
# Plugin Configurations
# ------------------------------------------------------------------------------

# tmux-resurrect: Save and restore sessions
# Save: prefix + Ctrl-s
# Restore: prefix + Ctrl-r
# Restore nvim sessions (requires nvim session plugin)
# set -g @resurrect-strategy-nvim 'session'

# tmux-continuum: Automatic session saving
# Automatically restore last session on tmux start
set -g @continuum-restore 'on'

# tmux-yank: Better clipboard integration
# Uses system clipboard automatically

# ------------------------------------------------------------------------------
# Additional plugins (Enable as needed)
# ------------------------------------------------------------------------------

# tmux-sessionx: Session manager with zoxide integration
# Press prefix + o for fuzzy session/directory switcher
# Requires: zoxide
# set -g @plugin 'omerxx/tmux-sessionx'
# set -g @sessionx-bind 'o'
# set -g @sessionx-zoxide-mode 'on'
# set -g @sessionx-window-height '85%'
# set -g @sessionx-window-width '75%'
# set -g @sessionx-filter-current 'false'
# set -g @sessionx-auto-accept 'off'

# tmux-floax: Floating terminal windows (like VSCode terminal)
# Press prefix + p for floating terminal overlay
# set -g @plugin 'omerxx/tmux-floax'
# set -g @floax-bind 'p'
# set -g @floax-width '80%'
# set -g @floax-height '80%'
# set -g @floax-border-color 'magenta'
# set -g @floax-text-color 'blue'
# set -g @floax-change-path 'true'

# tmux-fzf-url: Find and open URLs from scrollback with fzf
# Press prefix + u (default)
# set -g @plugin 'wfxr/tmux-fzf-url'
# set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
# set -g @fzf-url-history-limit '2000'

# tmux-thumbs: Quick text selection with hints (like Vimium)
# Press prefix + Space (default)
set -g @plugin 'fcsonline/tmux-thumbs'

# tmux-fzf: General fzf integration for tmux
set -g @plugin 'sainnhe/tmux-fzf'

# ------------------------------------------------------------------------------
# TPM Initialization
# ------------------------------------------------------------------------------

# Automatic TPM installation on first run
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TPM (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
